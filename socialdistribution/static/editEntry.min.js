(()=>{document.addEventListener("DOMContentLoaded",()=>{function S(){return document.querySelector('meta[name="csrf-token"]').getAttribute("content")}let a=document.querySelector("#content"),n=document.getElementById("preview"),h=document.querySelector(".editor-container"),m=h.firstElementChild,v=h.lastElementChild,l=document.querySelector("#contentType"),T=document.querySelector("#image"),d=document.getElementById("uploadImageBtn"),u=document.getElementById("insertImageBtn"),i="",t="";function g(){let e=l.value;e==="image"?(m.style.display="none",v.style.display="",a.value="",n.innerHTML="",d.style.display="",u.style.display="none",i="",t=""):e==="text/markdown"?(m.style.display="",v.style.display="",n.innerHTML=convertMarkdownToHtml(a.value),d.style.display="none",u.style.display="",i="",t=""):(m.style.display="",v.style.display="none",n.innerHTML="",d.style.display="none",u.style.display="none",i="",t="")}l.addEventListener("change",g);function M(e){return new Promise((o,s)=>{let r=new FileReader;r.onload=()=>{let c=r.result.split(",")[1];o(c)},r.onerror=s,r.readAsDataURL(e)})}a.addEventListener("input",()=>{l.value==="text/plain"?n.innerHTML="":n.innerHTML=convertMarkdownToHtml(a.value)});let p=document.body.dataset.initialContentType,k=document.body.dataset.initialContent;p==="image"||p==="application/base64"||p.startsWith("image/")?(l.value="image",g(),i=k||"",t=document.body.dataset.initialMime||"",n.innerHTML=`<img src="data:${t};base64,${i}" style="max-width:100%;">`):(l.value=p||"text/plain",n.innerHTML=convertMarkdownToHtml(a.value),g()),document.querySelector(".post-btn").addEventListener("click",async e=>{e.preventDefault();let o=document.querySelector("#title").value.trim(),s=document.querySelector("#description").value.trim(),r=document.querySelector('input[name="visibility"]:checked').value.toUpperCase(),c=document.querySelector("#contentType").value,b=document.querySelector("#content").value.trim(),f=c;if(c==="image"){if(!i){alert("Please choose an image.");return}b=i,t==="application/base64"?f="application/base64":f=`${t};base64`}let I=document.body,C=I.dataset.authorId,w=I.dataset.entryId,B=encodeURIComponent(w),H=w.split("/").filter(Boolean).pop(),L=C.split("/").filter(Boolean).pop(),$=`/api/authors/${L}/entries/${H}/`,q={title:o,content:b,description:s,visibility:r,contentType:f};try{let y=await fetch($,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":S()},body:JSON.stringify(q)}),E=await y.json();if(!y.ok){console.error("Server error:",E);return}console.log("Success:",E),alert("Post updated successfully!"),window.location.href=`/authors/${L}/entries/${B}/`}catch(y){console.error("Fetch error:",y)}}),document.querySelector(".cancel-btn").addEventListener("click",()=>{let e=document.body,o=e.dataset.authorId,s=e.dataset.entryId,r=encodeURIComponent(s),c=o.split("/").filter(Boolean).pop();window.location.href=`/authors/${c}/entries/${r}/`}),d.addEventListener("click",()=>{T.click()}),T.addEventListener("change",async function(){if(l.value!=="image")return;let e=this.files[0];if(!e)return;let o=await M(e);i=o,e.type==="image/png"?t="image/png":e.type==="image/jpeg"?t="image/jpeg":t="application/base64",n.innerHTML=`<img src="data:${t};base64,${o}" style="max-width:100%;">`,this.value=""}),u.addEventListener("click",()=>{let e=prompt("Enter image URL:");if(!e)return;let s=`![${prompt("Enter alt text (optional):","")||""}](${e})`;a.value+=(a.value?`

`:"")+s,n.innerHTML=convertMarkdownToHtml(a.value)})});})();
//# sourceMappingURL=editEntry.min.js.map
