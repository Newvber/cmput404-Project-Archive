{
  "version": 3,
  "sources": ["../../webapp/editEntry.js"],
  "sourcesContent": ["// The following written with completion assistance from Microsoft, Copilot/ ChatGPT, OpenAI 2025-07-09\ndocument.addEventListener('DOMContentLoaded', () => {\n  function getCSRFToken() {\n    return document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content');\n  }\n\n  const textarea = document.querySelector('#content');\n  const previewEl = document.getElementById('preview');\n  const editorContainer = document.querySelector('.editor-container');\n  const editBox = editorContainer.firstElementChild;\n  const previewBox = editorContainer.lastElementChild;\n  const contentTypeSelect = document.querySelector('#contentType');\n  const imageInput = document.querySelector('#image');\n  const uploadImageBtn = document.getElementById('uploadImageBtn');\n  const insertImageBtn = document.getElementById('insertImageBtn');\n  let soloImageBase64 = '';\n  let soloImageMime = '';\n\n  function updateMode() {\n    const type = contentTypeSelect.value;\n    if (type === 'image') {\n      editBox.style.display = 'none';\n      previewBox.style.display = '';\n      textarea.value = '';\n      previewEl.innerHTML = '';\n      uploadImageBtn.style.display = '';\n      insertImageBtn.style.display = 'none';\n      soloImageBase64 = '';\n      soloImageMime = '';\n    } else if (type === 'text/markdown') {\n      editBox.style.display = '';\n      previewBox.style.display = '';\n      previewEl.innerHTML = convertMarkdownToHtml(textarea.value);\n      uploadImageBtn.style.display = 'none';\n      insertImageBtn.style.display = '';\n      soloImageBase64 = '';\n      soloImageMime = '';\n    } else {\n      editBox.style.display = '';\n      previewBox.style.display = 'none';\n      previewEl.innerHTML = '';\n      uploadImageBtn.style.display = 'none';\n      insertImageBtn.style.display = 'none';\n      soloImageBase64 = '';\n      soloImageMime = '';\n    }\n  }\n\n  contentTypeSelect.addEventListener('change', updateMode);\n\n  function readFileAsBase64(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = reader.result.split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(file);\n    });\n  }\n\n  textarea.addEventListener('input', () => {\n    if (contentTypeSelect.value === 'text/plain') {\n      previewEl.innerHTML = '';\n    } else {\n      previewEl.innerHTML = convertMarkdownToHtml(textarea.value);\n    }\n  });\n\n  const initialContentType = document.body.dataset.initialContentType;\n  const initialContent = document.body.dataset.initialContent;\n  if (initialContentType === 'image' || initialContentType === 'application/base64' || initialContentType.startsWith('image/')) {\n    contentTypeSelect.value = 'image';\n    updateMode();\n    soloImageBase64 = initialContent || '';\n    soloImageMime = document.body.dataset.initialMime || '';\n    previewEl.innerHTML = `<img src=\"data:${soloImageMime};base64,${soloImageBase64}\" style=\"max-width:100%;\">`;\n  } else {\n    contentTypeSelect.value = initialContentType || 'text/plain';\n    previewEl.innerHTML = convertMarkdownToHtml(textarea.value);\n    updateMode();\n  }\n\n  document.querySelector('.post-btn').addEventListener('click', async event => {\n    event.preventDefault();\n    const title = document.querySelector('#title').value.trim();\n    const description = document.querySelector('#description').value.trim();\n    const visibility = document.querySelector('input[name=\"visibility\"]:checked').value.toUpperCase();\n    const selectedContentType = document.querySelector('#contentType').value;\n    let content = document.querySelector('#content').value.trim();\n    let finalContentType = selectedContentType;\n    if (selectedContentType === 'image') {\n      if (!soloImageBase64) {\n        alert('Please choose an image.');\n        return;\n      }\n      content = soloImageBase64;\n      if (soloImageMime === 'application/base64') {\n        finalContentType = 'application/base64';\n      } else {\n        finalContentType = `${soloImageMime};base64`;\n      }\n    }\n    const body = document.body;\n    const authorId = body.dataset.authorId;\n    const entryId = body.dataset.entryId;\n    const encodedEntryId = encodeURIComponent(entryId);\n    const entryUuid = entryId.split('/').filter(Boolean).pop();\n    const authorUuid = authorId.split('/').filter(Boolean).pop();\n    const url = `/api/authors/${authorUuid}/entries/${entryUuid}/`;\n    const data = { title, content, description, visibility, contentType: finalContentType };\n    try {\n      const response = await fetch(url, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCSRFToken() },\n        body: JSON.stringify(data)\n      });\n      const result = await response.json();\n      if (!response.ok) {\n        console.error('Server error:', result);\n        return;\n      }\n      console.log('Success:', result);\n      alert('Post updated successfully!');\n      window.location.href = `/authors/${authorUuid}/entries/${encodedEntryId}/`;\n    } catch (err) {\n      console.error('Fetch error:', err);\n    }\n  });\n\n  document.querySelector('.cancel-btn').addEventListener('click', () => {\n    const body = document.body;\n    const authorId = body.dataset.authorId;\n    const entryId = body.dataset.entryId;\n    const encodedEntryId = encodeURIComponent(entryId);\n    const authorUuid = authorId.split('/').filter(Boolean).pop();\n    window.location.href = `/authors/${authorUuid}/entries/${encodedEntryId}/`;\n  });\n\n  uploadImageBtn.addEventListener('click', () => {\n    imageInput.click();\n  });\n\n  imageInput.addEventListener('change', async function () {\n    if (contentTypeSelect.value !== 'image') return;\n    const file = this.files[0];\n    if (!file) return;\n    const base64 = await readFileAsBase64(file);\n    soloImageBase64 = base64;\n    if (file.type === 'image/png') {\n      soloImageMime = 'image/png';\n    } else if (file.type === 'image/jpeg') {\n      soloImageMime = 'image/jpeg';\n    } else {\n      soloImageMime = 'application/base64';\n    }\n    previewEl.innerHTML = `<img src=\"data:${soloImageMime};base64,${base64}\" style=\"max-width:100%;\">`;\n    this.value = '';\n  });\n\n  insertImageBtn.addEventListener('click', () => {\n    const url = prompt('Enter image URL:');\n    if (!url) return;\n    const alt = prompt('Enter alt text (optional):', '') || '';\n    let markdown = `![${alt}](${url})`;\n    textarea.value += (textarea.value ? '\\n\\n' : '') + markdown;\n    previewEl.innerHTML = convertMarkdownToHtml(textarea.value);\n  });\n});\n"],
  "mappings": "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",
  "names": ["getCSRFToken", "textarea", "previewEl", "editorContainer", "editBox", "previewBox", "contentTypeSelect", "imageInput", "uploadImageBtn", "insertImageBtn", "soloImageBase64", "soloImageMime", "updateMode", "type", "readFileAsBase64", "file", "resolve", "reject", "reader", "base64", "initialContentType", "initialContent", "event", "title", "description", "visibility", "selectedContentType", "content", "finalContentType", "body", "authorId", "entryId", "encodedEntryId", "entryUuid", "authorUuid", "url", "data", "response", "result", "err", "markdown"]
}
