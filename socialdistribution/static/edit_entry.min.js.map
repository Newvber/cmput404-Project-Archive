{
  "version": 3,
  "sources": ["../../webapp/edit_entry.js"],
  "sourcesContent": ["// edit_entry.js\n\nfunction getCSRFToken() {\n    return document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content');\n}\n\nconst imageMap = {};\nlet imageCounter = 1;\nconst textarea = document.querySelector('#content');\nconst previewEl = document.getElementById('preview');\nconst editorContainer = document.querySelector('.editor-container');\nconst editBox = editorContainer.firstElementChild;\nconst previewBox = editorContainer.lastElementChild;\nconst contentTypeSelect = document.querySelector('#contentType');\nconst imageInput = document.querySelector('#image');\nlet soloImageBase64 = '';\nlet soloImageMime = '';\n\nfunction updateMode() {\n    const type = contentTypeSelect.value;\n    if (type === 'image') {\n        editBox.style.display = 'none';\n        previewBox.style.display = '';\n        textarea.value = '';\n        previewEl.innerHTML = '';\n        imageInput.removeAttribute('multiple');\n    } else {\n        editBox.style.display = '';\n        previewBox.style.display = '';\n        previewEl.innerHTML = convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n        imageInput.setAttribute('multiple', '');\n        soloImageBase64 = '';\n        soloImageMime = '';\n    }\n}\n\ncontentTypeSelect.addEventListener('change', updateMode);\n\nfunction readFileAsBase64(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n            const base64 = reader.result.split(',')[1];\n            resolve(base64);\n        };\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n    });\n}\n\nfunction expandImagePlaceholders(text) {\n    let result = text;\n    for (const key in imageMap) {\n        result = result.replaceAll(`(${key})`, `(${imageMap[key]})`);\n    }\n    return result;\n}\n\ntextarea.addEventListener('input', () => {\n    previewEl.innerHTML = convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n});\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    if (window.ENTRY_IS_IMAGE) {\n        contentTypeSelect.value = 'image';\n        updateMode();\n        soloImageBase64 = window.ENTRY_CONTENT;\n        soloImageMime = window.ENTRY_CONTENT_TYPE.replace(';base64', '');\n        if (soloImageMime === 'application/base64') {\n            previewEl.innerHTML = `<img src=\"data:${soloImageMime};base64,${soloImageBase64}\" style=\"max-width:100%;\">`;\n        } else {\n            previewEl.innerHTML = `<img src=\"data:${soloImageMime};base64,${soloImageBase64}\" style=\"max-width:100%;\">`;\n        }\n    } else {\n        contentTypeSelect.value = window.ENTRY_CONTENT_TYPE;\n        previewEl.innerHTML = convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n        updateMode();\n    }\n});\n\ndocument.querySelector('.post-btn').addEventListener('click', async (event)=> {\n    event.preventDefault();\n\n    const title = document.querySelector('#title').value.trim();\n    const visibility = document.querySelector('input[name=\"visibility\"]:checked').value.toUpperCase();\n    const selectedContentType = document.querySelector('#contentType').value;\n\n    let content = expandImagePlaceholders(document.querySelector('#content').value.trim());\n    let finalContentType = selectedContentType;\n\n    if (selectedContentType === 'image') {\n        if (!soloImageBase64) {\n            alert('Please choose an image.');\n            return;\n        }\n        content = soloImageBase64;\n        if (soloImageMime === 'application/base64') {\n            finalContentType = 'application/base64';\n        } else {\n            finalContentType = `${soloImageMime};base64`;\n        }\n    }\n\n    const parts = window.location.pathname.split('/');\n    const authorId = parts[2];\n    const entryId = parts[4];\n    const url = `/api/authors/${authorId}/entries/${entryId}/`;\n\n    const data = {\n        title,\n        content,\n        description: title,\n        visibility,\n        contentType: finalContentType,\n    };\n\n    try {\n        const response = await fetch(url, {\n            method: 'PATCH',\n            headers: {\n                'Content-Type': 'application/json',\n                'X-CSRFToken': getCSRFToken()\n            },\n            body: JSON.stringify(data)\n        });\n\n        const result = await response.json();\n\n        if (!response.ok) {\n            console.error(\"Server error:\", result);\n            return;\n        }\n\n        console.log(\"Success:\", result);\n        alert(\"Post updated successfully!\");\n        window.location.href = `/authors/${authorId}/entries/${entryId}/`;\n    } catch (err) {\n        console.error(\"Fetch error:\", err);\n    }\n});\n\ndocument.querySelector('.cancel-btn').addEventListener('click', () => {\n    const parts = window.location.pathname.split('/');\n    const authorId = parts[2];\n    const entryId = parts[4];\n    window.location.href = `/authors/${authorId}/entries/${entryId}/`;\n});\n\ndocument.querySelector('#image').addEventListener('change', async function () {\n    const files = Array.from(this.files).slice(0, 15);\n    if (files.length > 0) {\n        if (contentTypeSelect.value === 'image') {\n            const file = files[0];\n            const base64 = await readFileAsBase64(file);\n            soloImageBase64 = base64;\n            if (file.type === 'image/png') {\n                soloImageMime = 'image/png';\n            } else if (file.type === 'image/jpeg') {\n                soloImageMime = 'image/jpeg';\n            } else {\n                soloImageMime = 'application/base64';\n            }\n            if (soloImageMime === 'application/base64') {\n                previewEl.innerHTML = `<img src=\"data:${soloImageMime};base64,${base64}\" style=\"max-width:100%;\">`;\n            } else {\n                previewEl.innerHTML = `<img src=\"data:${file.type};base64,${base64}\" style=\"max-width:100%;\">`;\n            }\n            this.value = '';\n        } else {\n            for (const file of files) {\n                const base64 = await readFileAsBase64(file);\n                const placeholder = `image${imageCounter++}`;\n                imageMap[placeholder] = `data:${file.type};base64,${base64}`;\n                const markdown = `![${file.name}](${placeholder})`;\n                textarea.value += (textarea.value ? \"\\n\\n\" : \"\") + markdown;\n            }\n            document.getElementById('preview').innerHTML =\n                convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n            document.querySelector('#contentType').value = 'text/markdown';\n            this.value = '';\n        }\n    }\n});\n"],
  "mappings": "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",
  "names": ["getCSRFToken", "imageMap", "imageCounter", "textarea", "previewEl", "editorContainer", "editBox", "previewBox", "contentTypeSelect", "imageInput", "soloImageBase64", "soloImageMime", "updateMode", "expandImagePlaceholders", "readFileAsBase64", "file", "resolve", "reject", "reader", "base64", "text", "result", "key", "event", "title", "visibility", "selectedContentType", "content", "finalContentType", "parts", "authorId", "entryId", "url", "data", "response", "err", "files", "placeholder", "markdown"]
}
