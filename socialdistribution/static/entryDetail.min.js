(()=>{document.addEventListener("DOMContentLoaded",()=>{let m=document.body,U=m.dataset.authorId,u=m.dataset.entryId,v=encodeURIComponent(u),I=u.split("/").filter(Boolean).pop(),E=m.dataset.currentUserId,s=U.split("/").filter(Boolean).pop(),p=document.querySelector('meta[name="csrf-token"]').content,h=document.getElementById("dropdown-toggle"),c=document.getElementById("dropdown-menu");h&&c&&(h.addEventListener("click",()=>{c.classList.toggle("hidden")}),document.addEventListener("click",t=>{!h.contains(t.target)&&!c.contains(t.target)&&c.classList.add("hidden")}));let $=document.getElementById("delete-entry-btn");$&&$.addEventListener("click",async()=>{if(confirm("Are you sure you want to delete this post?"))try{let t=await fetch(`/api/authors/${s}/entries/${I}/`,{method:"DELETE",headers:{"X-CSRFToken":p}});t.status===204?(alert("Post deleted successfully."),window.location.href="/"):t.status===403?alert("You are not authorized to delete this post."):(alert("Failed to delete the post."),console.error(await t.text()))}catch(t){alert("An error occurred while deleting the post."),console.error(t)}});let L=document.getElementById("edit-entry-btn");L&&L.addEventListener("click",()=>{window.location.href=`/authors/${s}/entries/${v}/edit/`});let r=document.getElementById("show-comment-form-btn"),y=document.getElementById("comment-form"),x=document.getElementById("cancel-comment-btn"),i=document.getElementById("send-comment-btn"),f=document.getElementById("comment-text");r.addEventListener("click",()=>{y.style.display="block",r.style.display="none"}),x.addEventListener("click",()=>{y.style.display="none",r.style.display="inline-block",f.value=""}),i.addEventListener("click",async()=>{let t=f.value.trim();if(!t)return alert("Please enter your comment");if(!i.disabled){i.disabled=!0;try{let n={type:"comment",comment:t,contentType:"text/plain",object:u,published:new Date().toISOString()},k=await fetch(`/api/authors/${s}/entries/${v}/commented/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":p},body:JSON.stringify(n)});if(k.ok)f.value="",y.style.display="none",r.style.display="inline-block",await B();else{let d=await k.json();alert(d.detail||"Fail to post a comment")}}finally{i.disabled=!1}}}),B();async function B(){let t=`/api/authors/${s}/entries/${I}/comments/`;try{let n=await fetch(t,{credentials:"include"});if(!n.ok){console.error("Comments fetch failed:",await n.text()),document.querySelector(".comments-section").innerHTML="<p>Could not load comments.</p>";return}let d=(await n.json()).src||[],w=document.querySelector(".comments-section");if(w.innerHTML="",d.length===0){w.innerHTML="<p>No comments yet.</p>";return}d.forEach(e=>{let l=new Date(e.published).toLocaleString(),b=e.author.id.split("/").filter(Boolean),S=b[b.length-1],g=e.author.profileImage||"/static/avatar.jpg";w.insertAdjacentHTML("beforeend",`
          <div class="comment-box">
            <div class="comment-avatar"><img src="${g}" alt="Avatar"></div>
            <div class="comment-content">
              <div class="comment-author">${e.author.displayName}</div>
              <span class="comment-date">${l}</span>
              <div class="comment-text">${e.comment}</div>
              <div class="comment-actions">
                <button class="comment-action-btn" data-comment-id="${e.id}" data-author-id="${S}">
                  <span class="action-icon">\u2764\uFE0F</span>
                  <span class="action-text like-count">${e.likes.count||0} Likes</span>
                </button>
              </div>
            </div>
          </div>
        `)}),document.querySelectorAll(".comment-action-btn").forEach(e=>e.addEventListener("click",async function(){let l=this.dataset.commentId,C=l.replace(/\/$/,"").split("/").pop(),g=`/api/authors/${this.dataset.authorId.split("/").filter(Boolean).pop()}/inbox/`,T;try{let o=E.split("/").filter(Boolean).pop(),a=await fetch(`/api/authors/${o}/`);if(!a.ok)throw new Error("author fetch failed");T=await a.json()}catch{alert("Failed to fetch author info.");return}let j=`${E.replace(/\/+$/,"")}/liked/${crypto.randomUUID()}`,A={type:"like",author:T,object:l,published:new Date().toISOString(),id:j};try{let o=await fetch(g,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":p},body:JSON.stringify(A)});if(o.ok){let a=this.querySelector(".like-count"),F=parseInt(a.textContent)||0;a.textContent=`${F+1} Likes`,this.disabled=!0}else{let a=await o.json();alert(a.detail||"Failed to like this comment again")}}catch(o){console.error(o),alert("Network error")}}))}catch(n){console.error(n)}}});})();
//# sourceMappingURL=entryDetail.min.js.map
