{
  "version": 3,
  "sources": ["../../webapp/entryDetail.js"],
  "sourcesContent": ["// The following written with completion assistance from Microsoft, Copilot/ ChatGPT, OpenAI 2025-07-09\ndocument.addEventListener('DOMContentLoaded', () => {\n  const body = document.body;\n  const authorId = body.dataset.authorId;\n  const entryId = body.dataset.entryId;\n  const encodedEntryId = encodeURIComponent(entryId);\n  const entryUuid = entryId.split('/').filter(Boolean).pop();\n  const currentUserId = body.dataset.currentUserId;\n  const authorUuid = authorId.split('/').filter(Boolean).pop();\n  const csrfToken = document.querySelector('meta[name=\"csrf-token\"]').content;\n  \n\n  const dropdownToggle = document.getElementById('dropdown-toggle');\n  const dropdownMenu = document.getElementById('dropdown-menu');\n\n  if (dropdownToggle && dropdownMenu) {\n    dropdownToggle.addEventListener('click', () => {\n      dropdownMenu.classList.toggle('hidden');\n    });\n    \n    document.addEventListener('click', (e) => {\n      if (!dropdownToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {\n        dropdownMenu.classList.add('hidden');\n      }\n    });\n  }\n\n  const deleteBtn = document.getElementById('delete-entry-btn');\n  if (deleteBtn) {\n    deleteBtn.addEventListener('click', async () => {\n      if (!confirm('Are you sure you want to delete this post?')) return;\n      try {\n        const res = await fetch(`/api/authors/${authorUuid}/entries/${entryUuid}/`, {\n\n          method: 'DELETE',\n          headers: { 'X-CSRFToken': csrfToken }\n        });\n        if (res.status === 204) {\n          alert('Post deleted successfully.');\n          window.location.href = '/';\n        } else if (res.status === 403) {\n          alert('You are not authorized to delete this post.');\n        } else {\n          alert('Failed to delete the post.');\n          console.error(await res.text());\n        }\n      } catch (err) {\n        alert('An error occurred while deleting the post.');\n        console.error(err);\n      }\n    });\n  }\n\n  const editBtn = document.getElementById('edit-entry-btn');\n  if (editBtn) {\n    editBtn.addEventListener('click', () => {\n      window.location.href = `/authors/${authorUuid}/entries/${encodedEntryId}/edit/`;\n    });\n  }\n\n  const showFormBtn = document.getElementById('show-comment-form-btn');\n  const commentForm = document.getElementById('comment-form');\n  const cancelBtn = document.getElementById('cancel-comment-btn');\n  const sendBtn = document.getElementById('send-comment-btn');\n  const commentText = document.getElementById('comment-text');\n\n  showFormBtn.addEventListener('click', () => {\n    commentForm.style.display = 'block';\n    showFormBtn.style.display = 'none';\n  });\n\n  cancelBtn.addEventListener('click', () => {\n    commentForm.style.display = 'none';\n    showFormBtn.style.display = 'inline-block';\n    commentText.value = '';\n  });\n\n  sendBtn.addEventListener('click', async () => {\n    const content = commentText.value.trim();\n    if (!content) return alert('Please enter your comment');\n\n    // prevent duplicate submissions\n    if (sendBtn.disabled) return;\n    sendBtn.disabled = true;\n\n    try {\n      const payload = {\n        type: 'comment',\n        comment: content,\n        contentType: 'text/plain',\n        object: entryId,\n        published: new Date().toISOString()\n      };\n      const res = await fetch(`/api/authors/${authorUuid}/entries/${encodedEntryId}/commented/`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrfToken\n        },\n        body: JSON.stringify(payload)\n      });\n      if (res.ok) {\n        commentText.value = '';\n        commentForm.style.display = 'none';\n        showFormBtn.style.display = 'inline-block';\n        await loadComments();\n      } else {\n        const err = await res.json();\n        alert(err.detail || 'Fail to post a comment');\n      }\n    } finally {\n      sendBtn.disabled = false;\n    }\n  });\n\n  loadComments();\n\n  async function loadComments() {\n    const url = `/api/authors/${authorUuid}/entries/${entryUuid}/comments/`;\n    try {\n      const res = await fetch(url, { credentials: 'include' });\n      if (!res.ok) {\n        console.error(\"Comments fetch failed:\", await res.text());\n        document.querySelector('.comments-section').innerHTML =\n          '<p>Could not load comments.</p>';\n        return;\n      };\n      const data = await res.json();\n      const list = data.src || [];\n      const container = document.querySelector('.comments-section');\n      container.innerHTML = '';\n      if (list.length === 0) {\n        container.innerHTML = '<p>No comments yet.</p>';\n        return;\n      }\n      list.forEach(c => {\n        const date = new Date(c.published).toLocaleString();\n        const authorUrl = c.author.id;\n        const parts = authorUrl.split('/').filter(Boolean);\n        const commentAuthorUuid = parts[parts.length - 1];\n        const avatar = c.author.profileImage || '/static/avatar.jpg';\n        container.insertAdjacentHTML('beforeend', `\n          <div class=\"comment-box\">\n            <div class=\"comment-avatar\"><img src=\"${avatar}\" alt=\"Avatar\"></div>\n            <div class=\"comment-content\">\n              <div class=\"comment-author\">${c.author.displayName}</div>\n              <span class=\"comment-date\">${date}</span>\n              <div class=\"comment-text\">${c.comment}</div>\n              <div class=\"comment-actions\">\n                <button class=\"comment-action-btn\" data-comment-id=\"${c.id}\" data-author-id=\"${commentAuthorUuid}\">\n                  <span class=\"action-icon\">\u2764\uFE0F</span>\n                  <span class=\"action-text like-count\">${c.likes.count || 0} Likes</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        `);\n      });\n      document.querySelectorAll('.comment-action-btn').forEach(btn => btn.addEventListener('click', async function () {\n        const commentId = this.dataset.commentId;\n        const commentUuid = commentId.replace(/\\/$/, '').split('/').pop();\n        const commentAuthor = this.dataset.authorId;\n        const commentAuthorUuid = commentAuthor.split('/').filter(Boolean).pop();\n        const inboxUrl = `/api/authors/${commentAuthorUuid}/inbox/`;\n        let authorData;\n        try {\n          const currentUserUuid = currentUserId.split('/').filter(Boolean).pop();\n          const r = await fetch(`/api/authors/${currentUserUuid}/`);\n          if (!r.ok) throw new Error('author fetch failed');\n          authorData = await r.json();\n        } catch (err) {\n          alert('Failed to fetch author info.');\n          return;\n        }\n\n          const likeId = `${currentUserId.replace(/\\/+$/, '')}/liked/${crypto.randomUUID()}`;\n          const payload = {\n            type: 'like',\n            author: authorData,\n            object: commentId,\n            published: new Date().toISOString(),\n            id: likeId\n          };\n        try {\n          const res = await fetch(inboxUrl, {\n            method: 'POST',\n            credentials: 'include',\n            headers: {\n              'Content-Type': 'application/json',\n              'X-CSRFToken': csrfToken\n            },\n            body: JSON.stringify(payload)\n          });\n          if (res.ok) {\n            const span = this.querySelector('.like-count');\n            const current = parseInt(span.textContent) || 0;\n            span.textContent = `${current + 1} Likes`;\n            this.disabled = true;\n          } else {\n            const e = await res.json();\n            alert(e.detail || 'Failed to like this comment again');\n          }\n        } catch (e) {\n          console.error(e);\n          alert('Network error');\n        }\n      }));\n    } catch (e) {\n      console.error(e);\n    }\n  }\n});\n\n\n\n"],
  "mappings": "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",
  "names": ["body", "authorId", "entryId", "encodedEntryId", "entryUuid", "currentUserId", "authorUuid", "csrfToken", "dropdownToggle", "dropdownMenu", "e", "deleteBtn", "res", "err", "editBtn", "showFormBtn", "commentForm", "cancelBtn", "sendBtn", "commentText", "content", "payload", "loadComments", "url", "list", "container", "c", "date", "parts", "commentAuthorUuid", "avatar", "btn", "commentId", "commentUuid", "inboxUrl", "authorData", "currentUserUuid", "r", "likeId", "span", "current"]
}
