(()=>{var w=document.getElementById("delete-entry-btn");w&&w.addEventListener("click",async()=>{if(!confirm("Are you sure you want to delete this post?"))return;let n=window.ENTRY_AUTHOR_ID,o=window.ENTRY_ID,r=document.querySelector('meta[name="csrf-token"]').content;try{let t=await fetch(`/api/authors/${n}/entries/${o}/`,{method:"DELETE",headers:{"X-CSRFToken":r}});t.status===204?(alert("Post deleted successfully."),window.location.href="/"):t.status===403?alert("You are not authorized to delete this post."):(alert("Failed to delete the post."),console.error(await t.text()))}catch(t){alert("An error occurred while deleting the post."),console.error(t)}});var v=document.getElementById("edit-entry-btn");v&&v.addEventListener("click",()=>{window.location.href=`/authors/${window.ENTRY_AUTHOR_ID}/entries/${window.ENTRY_ID}/edit/`});document.addEventListener("DOMContentLoaded",function(){let n=document.getElementById("show-comment-form-btn"),o=document.getElementById("comment-form"),r=document.getElementById("cancel-comment-btn"),t=document.getElementById("send-comment-btn"),u=document.getElementById("comment-text");n.addEventListener("click",()=>{o.style.display="block",n.style.display="none"}),r.addEventListener("click",()=>{o.style.display="none",n.style.display="inline-block",u.value=""}),t.addEventListener("click",async()=>{let d=u.value.trim();if(!d)return alert("Please enter your comment");let c=window.ENTRY_AUTHOR_ID,e=window.ENTRY_ID,l=document.querySelector('meta[name="csrf-token"]').content,m=`${window.location.origin}/api/authors/${c}/entries/${e}/`,i={type:"comment",comment:d,contentType:"text/plain",object:m,published:new Date().toISOString()},a=await fetch(`/api/authors/${c}/inbox/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":l},body:JSON.stringify(i)});if(a.ok){let s=await a.json();document.querySelector(".comments-section").insertAdjacentHTML("afterbegin",`
        <div class="comment-box">
          <div class="comment-avatar">
            <img src="/static/images/default-avatar.png" alt="Avatar">
          </div>
          <div class="comment-content">
            <div class="comment-header">
              <span class="comment-author">${s.author.displayName}</span> |
              <span class="comment-date">${s.published}</span>
            </div>
            <div class="comment-text">${s.comment}</div>
          </div>
        </div>
      `),u.value="",o.style.display="none",n.style.display="inline-block"}else{let s=await a.json();alert(s.detail||"Fail to post a comment")}}),k()});async function k(){let n=window.ENTRY_AUTHOR_ID,o=window.ENTRY_ID,r=`/api/authors/${n}/entries/${o}/comments/`;try{let t=await fetch(r,{credentials:"include"});if(!t.ok)throw"";let d=(await t.json()).src||[],c=document.querySelector(".comments-section");if(c.innerHTML="",d.length===0){c.innerHTML="<p>No comments yet.</p>";return}d.forEach(e=>{let l=new Date(e.published).toLocaleString(),i=e.author.id.split("/").filter(Boolean),a=i[i.length-1];c.insertAdjacentHTML("beforeend",`
        <div class="comment-box">
          <div class="comment-avatar"><img src="/static/images/default-avatar.png" alt="Avatar"></div>
          <div class="comment-content">
            <div class="comment-author">${e.author.displayName}</div>
            <span class="comment-date">${l}</span>
            <div class="comment-text">${e.comment}</div>
            <div class="comment-actions">
              <button class="comment-action-btn"
                  data-comment-id="${e.id}"
                  data-author-id="${a}">
                  <span class="action-icon">\u2764\uFE0F</span>
                  <span class="action-text like-count">${e.likes.count||0} Likes</span>
              </button>
            </div>
          </div>
        </div>
      `)}),document.querySelectorAll(".comment-action-btn").forEach(e=>e.addEventListener("click",async function(){let l=this.dataset.commentId,m=this.dataset.authorId,i=window.CURRENT_USER_ID,a=document.querySelector('meta[name="csrf-token"]').content,s=`/api/authors/${m}/inbox/`,p={type:"like",author:{id:`${window.location.origin}/api/authors/${i}/`},object:(l.startsWith("http")?l:`${window.location.origin}/api/authors/${m}/commented/${l}/`),published:new Date().toISOString()};try{let h=await fetch(s,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":a},body:JSON.stringify(p)});if(h.ok){let y=this.querySelector(".like-count"),f=parseInt(y.textContent)||0;y.textContent=`${f+1} Likes`,this.disabled=!0}else{let y=await h.json();alert(y.detail||"Failed to like this comment again")}}catch(h){console.error(h),alert("Network error")}}))}catch(t){console.error(t)}}})();
//# sourceMappingURL=entry_detail.min.js.map
