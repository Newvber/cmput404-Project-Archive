{
  "version": 3,
  "sources": ["../../webapp/entry_detail.js"],
  "sourcesContent": ["// entry_detail.js\n\nconst deleteBtn = document.getElementById('delete-entry-btn');\nif (deleteBtn) {\n  deleteBtn.addEventListener('click', async () => {\n    if (!confirm(\"Are you sure you want to delete this post?\")) return;\n\n    const authorId = window.ENTRY_AUTHOR_ID;\n    const entryId  = window.ENTRY_ID;\n    const csrfToken = document.querySelector('meta[name=\"csrf-token\"]').content;\n\n    try {\n      const res = await fetch(`/api/authors/${authorId}/entries/${entryId}/`, {\n        method: 'DELETE',\n        headers: {\n          'X-CSRFToken': csrfToken\n        }\n      });\n\n      if (res.status === 204) {\n        alert(\"Post deleted successfully.\");\n        window.location.href = \"/\";\n      } else if (res.status === 403) {\n        alert(\"You are not authorized to delete this post.\");\n      } else {\n        alert(\"Failed to delete the post.\");\n        console.error(await res.text());\n      }\n    } catch (err) {\n      alert(\"An error occurred while deleting the post.\");\n      console.error(err);\n    }\n  });\n}\n\nconst editBtn = document.getElementById('edit-entry-btn');\nif (editBtn) {\n  editBtn.addEventListener('click', () => {\n    window.location.href = `/authors/${window.ENTRY_AUTHOR_ID}/entries/${window.ENTRY_ID}/edit/`;\n  });\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  const showFormBtn = document.getElementById(\"show-comment-form-btn\");\n  const commentForm = document.getElementById(\"comment-form\");\n  const cancelBtn = document.getElementById(\"cancel-comment-btn\");\n  const sendBtn = document.getElementById(\"send-comment-btn\");\n  const commentText = document.getElementById(\"comment-text\");\n\n  showFormBtn.addEventListener(\"click\", () => {\n    commentForm.style.display = \"block\";\n    showFormBtn.style.display = \"none\";\n  });\n\n  cancelBtn.addEventListener(\"click\", () => {\n    commentForm.style.display = \"none\";\n    showFormBtn.style.display = \"inline-block\";\n    commentText.value = \"\";\n  });\n\n  sendBtn.addEventListener(\"click\", async () => {\n    const content = commentText.value.trim();\n    if (!content) return alert(\"Please enter your comment\");\n\n    const authorId = window.ENTRY_AUTHOR_ID;\n    const entryId  = window.ENTRY_ID;\n    const csrftoken = document.querySelector('meta[name=\"csrf-token\"]').content;\n\n    const entryUrl = `${window.location.origin}/api/authors/${authorId}/entries/${entryId}/`;\n\n    const payload = {\n      type:        \"comment\",\n      comment:     content,\n      contentType: \"text/plain\",\n      object:      entryUrl,\n      published:   new Date().toISOString()\n    };\n\n    const res = await fetch(`/api/authors/${authorId}/inbox/`, {\n      method:  \"POST\",\n      headers: {\n        \"Content-Type\":  \"application/json\",\n        \"X-CSRFToken\":   csrftoken\n      },\n      body: JSON.stringify(payload)\n    });\n\n    if (res.ok) {\n      const data = await res.json();\n      const commentsSection = document.querySelector(\".comments-section\");\n      commentsSection.insertAdjacentHTML(\"afterbegin\", `\n        <div class=\"comment-box\">\n          <div class=\"comment-avatar\">\n            <img src=\"/static/images/default-avatar.png\" alt=\"Avatar\">\n          </div>\n          <div class=\"comment-content\">\n            <div class=\"comment-header\">\n              <span class=\"comment-author\">${data.author.displayName}</span> |\n              <span class=\"comment-date\">${data.published}</span>\n            </div>\n            <div class=\"comment-text\">${data.comment}</div>\n          </div>\n        </div>\n      `);\n      commentText.value = \"\";\n      commentForm.style.display = \"none\";\n      showFormBtn.style.display = \"inline-block\";\n    } else {\n      const err = await res.json();\n      alert(err.detail || \"Fail to post a comment\");\n    }\n  });\n  loadComments();\n});\n\nasync function loadComments(){\n  const authorId = window.ENTRY_AUTHOR_ID;\n  const entryId  = window.ENTRY_ID;\n  const url      = `/api/authors/${authorId}/entries/${entryId}/comments/`;\n  try{\n    const res  = await fetch(url, { credentials:'include' }); if(!res.ok) throw'';\n    const data = await res.json(); const list = data.src||[];\n    const container = document.querySelector('.comments-section');\n    container.innerHTML='';\n    if(list.length===0){ container.innerHTML='<p>No comments yet.</p>'; return; }\n    list.forEach(c=>{\n      const date = new Date(c.published).toLocaleString();\n      const authorUrl = c.author.id;\n      const parts     = authorUrl.split('/').filter(Boolean);\n      const commentAuthorUuid = parts[parts.length - 1];\n\n      container.insertAdjacentHTML('beforeend', `\n        <div class=\"comment-box\">\n          <div class=\"comment-avatar\"><img src=\"/static/images/default-avatar.png\" alt=\"Avatar\"></div>\n          <div class=\"comment-content\">\n            <div class=\"comment-author\">${c.author.displayName}</div>\n            <span class=\"comment-date\">${date}</span>\n            <div class=\"comment-text\">${c.comment}</div>\n            <div class=\"comment-actions\">\n              <button class=\"comment-action-btn\"\n                  data-comment-id=\"${c.id}\"\n                  data-author-id=\"${commentAuthorUuid}\">\n                  <span class=\"action-icon\">\u2764\uFE0F</span>\n                  <span class=\"action-text like-count\">${c.likes.count||0} Likes</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      `);\n    });\n    document.querySelectorAll('.comment-action-btn').forEach(btn=>btn.addEventListener('click',async function(){\n      const commentId = this.dataset.commentId;\n      const commentAuthor = this.dataset.authorId;\n      const me = window.CURRENT_USER_ID;\n      const token = document.querySelector('meta[name=\"csrf-token\"]').content;\n      const inboxUrl = `/api/authors/${commentAuthor}/inbox/`;\n      const payload={type:'like',author:{id:`${window.location.origin}/api/authors/${me}/`},object:`${window.location.origin}/api/authors/${commentAuthor}/commented/${commentId}/`,published:new Date().toISOString()};\n      try{\n        const res=await fetch(inboxUrl,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json','X-CSRFToken':token},body:JSON.stringify(payload)});\n        if(res.ok){const span=this.querySelector('.like-count');const current=parseInt(span.textContent)||0;span.textContent=`${current+1} Likes`;this.disabled=true;} else {const e=await res.json();alert(e.detail||'Failed to like this comment again');}\n      }catch(e){console.error(e);alert('Network error');}\n    }));\n\n  }catch(e){ console.error(e); }\n}\n"],
  "mappings": "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",
  "names": ["deleteBtn", "authorId", "entryId", "csrfToken", "res", "err", "editBtn", "showFormBtn", "commentForm", "cancelBtn", "sendBtn", "commentText", "content", "csrftoken", "entryUrl", "payload", "data", "loadComments", "url", "list", "container", "c", "date", "parts", "commentAuthorUuid", "btn", "commentId", "commentAuthor", "me", "token", "inboxUrl", "span", "current", "e"]
}
