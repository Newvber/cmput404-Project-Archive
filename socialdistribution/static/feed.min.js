(()=>{document.addEventListener("DOMContentLoaded",()=>{let l=document.body,p=l.dataset.authenticated==="1",c=l.dataset.currentUserId;if(p){let t=document.getElementById("new-post-btn");t&&t.addEventListener("click",()=>{c&&(window.location.href=`/feed/${encodeURIComponent(c)}/newpost/`)}),document.querySelectorAll(".like-btn").forEach(e=>{e.addEventListener("click",async function(){let o=this.dataset.authorId,n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),r=this.dataset.postId.replace(/\/+$/,""),i;try{let a=c.split("/").filter(Boolean).pop(),d=await fetch(`/api/authors/${a}/`);if(!d.ok)throw new Error("author fetch failed");i=await d.json()}catch{alert("Failed to fetch author info.");return}let f=`${c.replace(/\/+$/,"")}/liked/${crypto.randomUUID()}`,I={type:"like",author:i,object:r,published:new Date().toISOString(),id:f};try{let d=`/api/authors/${o.split("/").filter(Boolean).pop()}/inbox/`,u=await fetch(d,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify(I)});if(!u.ok)throw await u.json();let h=this.querySelector(".like-count"),s=parseInt(h.textContent)||0;s+=1,h.textContent=`${s} ${s===1?"Like":"Likes"}`}catch(a){alert(a.detail||"You've liked this post already")}})}),document.querySelectorAll(".comment-btn").forEach(e=>{e.addEventListener("click",function(){let o=this.dataset.postId,n=this.getAttribute("data-author-id");if(o&&n){let r=n.split("/").filter(Boolean).pop(),i=encodeURIComponent(o);window.location.href=`/authors/${r}/entries/${i}/`}})})}document.querySelectorAll(".post-avatar").forEach(t=>{t.addEventListener("click",function(){let e=this.getAttribute("data-author-id");if(e){let o=encodeURIComponent(e);window.location.href=`/authors/${o}/`}})}),document.querySelectorAll(".post-title-link").forEach(t=>{t.addEventListener("click",()=>{let e=t.dataset.authorId,o=t.dataset.postId,n=encodeURIComponent(o),r=e.split("/").filter(Boolean).pop();window.location.href=`/authors/${r}/entries/${n}/`})})});})();
//# sourceMappingURL=feed.min.js.map
