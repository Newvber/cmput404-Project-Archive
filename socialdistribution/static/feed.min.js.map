{
  "version": 3,
  "sources": ["../../webapp/feed.js"],
  "sourcesContent": ["// The following written with completion assistance from Microsoft, Copilot/ ChatGPT, OpenAI 2025-07-09\ndocument.addEventListener('DOMContentLoaded', () => {\n  const body = document.body;\n  const isAuth = body.dataset.authenticated === '1';\n  const currentUserId = body.dataset.currentUserId;\n\n  if (isAuth) {\n    const newPostBtn = document.getElementById('new-post-btn');\n    if (newPostBtn) {\n      newPostBtn.addEventListener('click', () => {\n        if (!currentUserId) return;\n        window.location.href = `/feed/${encodeURIComponent(currentUserId)}/newpost/`;\n      });\n    }\n\n    document.querySelectorAll(\".like-btn\").forEach(button => {\n        button.addEventListener(\"click\", async function() {\n          const authorId  = this.dataset.authorId;\n          const csrfToken = document.querySelector('meta[name=\"csrf-token\"]').getAttribute(\"content\");\n\n          const entryUrl = this.dataset.postId.replace(/\\/+$/, \"\");\n\n          let author;\n          try {\n            const currentUserUuid = currentUserId.split('/').filter(Boolean).pop();\n            const r = await fetch(`/api/authors/${currentUserUuid}/`);\n            if (!r.ok) throw new Error('author fetch failed');\n            author = await r.json();\n          } catch (e) {\n            alert('Failed to fetch author info.');\n            return;\n          }\n\n          const likeId = `${currentUserId.replace(/\\/+$/, '')}/liked/${crypto.randomUUID()}`;\n          const payload = {\n          type: \"like\",\n          author,\n          object: entryUrl,\n          published: new Date().toISOString(),\n          id: likeId\n          };\n\n          try {\n          const authorUuid = authorId.split('/').filter(Boolean).pop();\n          const inboxUrl = `/api/authors/${authorUuid}/inbox/`;\n          const res = await fetch(\n              inboxUrl,\n              {\n              method: \"POST\",\n              credentials: \"include\",\n              headers: {\n                  \"Content-Type\": \"application/json\",\n                  \"X-CSRFToken\": csrfToken\n              },\n              body: JSON.stringify(payload)\n              });\n          if (!res.ok) {const err = await res.json(); throw err;};\n          const countElem = this.querySelector(\".like-count\");\n          let count = parseInt(countElem.textContent) || 0;\n          count += 1;\n          countElem.textContent = `${count} ${count === 1 ? \"Like\" : \"Likes\"}`;\n\n          } catch (err) {\n          alert(err.detail || \"You've liked this post already\");\n          // can't distinguish whether it failed or actually liked.. but whatever...\n          // alert(err.detail || \"Failed to like this post\");\n          }\n\n        });\n      });\n\n    document.querySelectorAll('.comment-btn').forEach(button => {\n      button.addEventListener('click', function () {\n        const rawPostId   = this.dataset.postId;\n        const authorId = this.getAttribute('data-author-id');\n        if (rawPostId && authorId) {\n          const authorUuid = authorId.split('/').filter(Boolean).pop();\n          const entryId = encodeURIComponent(rawPostId);\n          window.location.href = `/authors/${authorUuid}/entries/${entryId}/`;\n        }\n      });\n    });\n  }\n\n  document.querySelectorAll('.post-avatar').forEach(header => {\n    header.addEventListener('click', function () {\n      const authorId = this.getAttribute('data-author-id');\n      if (authorId) {\n        const encoded = encodeURIComponent(authorId);\n        window.location.href = `/authors/${encoded}/`;\n      }\n    });\n  });\n\n  document.querySelectorAll('.post-title-link').forEach(link => {\n    link.addEventListener('click', () => {\n      const authorId = link.dataset.authorId;\n      const rawId    = link.dataset.postId;              \n      const entryId  = encodeURIComponent(rawId);\n      const authorUuid = authorId.split('/').filter(Boolean).pop();        \n      window.location.href = `/authors/${authorUuid}/entries/${entryId}/`;\n    });\n  });\n\n});\n"],
  "mappings": "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",
  "names": ["body", "isAuth", "currentUserId", "newPostBtn", "button", "authorId", "csrfToken", "entryUrl", "author", "currentUserUuid", "r", "likeId", "payload", "inboxUrl", "res", "countElem", "count", "err", "rawPostId", "authorUuid", "entryId", "header", "encoded", "link", "rawId"]
}
