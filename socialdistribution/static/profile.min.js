(()=>{var L=document.body.dataset.currentUserId,j=L.split("/").filter(Boolean).pop(),y=`/api/authors/${j}/`;document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("follow-btn");if(!t)return;async function e(o){let i=o.replace(/\/$/,"").split("/").pop(),n=await fetch(`/api/authors/${i}/`);if(!n.ok)throw new Error("author fetch failed");return await n.json()}t.addEventListener("click",async function(){let o=t.dataset.following,i=document.body.dataset.profileId,n=document.body.dataset.currentUserId,u=`/api/authors/${i.split("/").filter(Boolean).pop()}/inbox/`,l=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),d=u,c,s;if(o==="false"){c="POST";try{let r=await e(n),m=await e(i);s={type:"follow",summary:`${r.displayName} wants to follow ${m.displayName}`,actor:r,object:m}}catch{alert("Failed to fetch author info.");return}}else d="/api/follow/",c="DELETE",s={from_author:n,to_author:i};try{let r=await fetch(d,{method:c,credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":l},body:JSON.stringify(s)});if(r.ok)window.location.reload();else{let m=await r.json();alert(m.detail||"Request failed")}}catch(r){console.error("Inbox request error",r),alert("Network error, operation failed")}})});function f(){document.getElementById("settingsModal").style.display="flex"}window.openSettings=f;function h(){document.getElementById("settingsModal").style.display="none"}window.closeSettings=h;function P(){h(),document.getElementById("changeNameModal").style.display="flex"}window.openChangeName=P;function E(){document.getElementById("changeNameModal").style.display="none",f()}window.closeChangeName=E;function x(){h(),document.getElementById("changeUsernameModal").style.display="flex"}window.openChangeUsername=x;function v(){document.getElementById("changeUsernameModal").style.display="none",f()}window.closeChangeUsername=v;function M(){h(),document.getElementById("changePasswordModal").style.display="flex"}window.openChangePassword=M;function N(){document.getElementById("changePasswordModal").style.display="none",f()}window.closeChangePassword=N;function A(){h(),document.getElementById("linkGithubModal").style.display="flex"}window.openLinkGithub=A;function B(){document.getElementById("linkGithubModal").style.display="none",f()}window.closeLinkGithub=B;var w=!1;function $(){let t=document.getElementById("settingsModal");w=t&&t.style.display!=="none",h(),document.getElementById("changeAvatarModal").style.display="flex";let e=document.getElementById("avatar-file-input"),o=document.getElementById("avatar-url-input");e&&(e.value=""),o&&(o.value="")}window.openChangeAvatar=$;function S(){document.getElementById("changeAvatarModal").style.display="none",w&&f()}window.closeChangeAvatar=S;async function D(t){return new Promise(e=>{let o=new Image;o.onload=()=>e(!0),o.onerror=()=>e(!1),o.src=t})}var b=document.getElementById("edit-profile-btn");b&&b.addEventListener("click",f);var C=document.getElementById("profile-avatar");if(C){let t=document.body.dataset.isSelf==="True"||document.body.dataset.isSelf==="true"}var k=document.getElementById("change-avatar-submit");k&&k.addEventListener("click",async function(){let t=document.getElementById("avatar-file-input"),e=document.getElementById("avatar-url-input"),o=t?t.files[0]:null,i=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),n;if(o){let a=new FormData;a.append("profile_image",o),n=await fetch(y,{method:"PUT",credentials:"include",headers:{"X-CSRFToken":i},body:a})}else{let a=e.value.trim();if(!a){alert("Provide a file or URL.");return}if(!await D(a)){alert("Invalid image URL.");return}n=await fetch(y,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":i},body:JSON.stringify({profile_image:a})})}if(n.ok){let a=await n.json();C.src=a.profileImage,w=!1,S()}else{let a=await n.json();alert(a.error||"Upload failed")}});document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("change-name-submit"),e=document.getElementById("change-username-submit"),o=document.getElementById("change-password-submit"),i=document.getElementById("new-display-name"),n=document.getElementById("new-username"),a=document.getElementById("new-password"),u=document.getElementById("confirm-password"),l=document.getElementById("link-github-submit"),d=document.getElementById("github-link-input"),c=document.querySelector('meta[name="csrf-token"]').getAttribute("content");t&&t.addEventListener("click",async function(){let s=i.value.trim();if(!s){alert("Name cannot be empty.");return}if(res=await fetch(y,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify({display_name:s})}),res.ok)E(),window.location.reload();else{let r=await res.json();alert(r.error||"Update failed")}}),e&&e.addEventListener("click",async function(){let s=n.value.trim();if(!s){alert("Username cannot be empty.");return}if(res=await fetch(y,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify({username:s})}),res.ok)v(),window.location.reload();else{let r=await res.json();alert(r.error||"Update failed")}}),o&&o.addEventListener("click",async function(){let s=a.value,r=u.value;if(!s){alert("Password cannot be empty.");return}if(s!==r){alert("Passwords do not match.");return}if(res=await fetch(y,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify({password:s})}),res.ok)window.location.href="/login/";else{let m=await res.json();alert(m.error||"Update failed")}}),l&&l.addEventListener("click",async function(){let s=d.value.trim();if(!s){alert("Github link cannot be empty.");return}if(res=await fetch(y,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify({github_link:s})}),res.ok)B(),window.location.reload();else{let r=await res.json();alert(r.error||"Update failed")}})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".like-btn").forEach(e=>{e.addEventListener("click",async function(){let i=this.dataset.postId.replace(/\/+$/,""),a=this.dataset.authorId.split("/").filter(Boolean).pop(),u=document.body.dataset.currentUserId,l=u.split("/").filter(Boolean).pop(),d=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),c;try{let p=await fetch(`/api/authors/${l}/`);if(!p.ok)throw new Error("author fetch failed");c=await p.json()}catch{alert("Failed to fetch author info.");return}let s=`${u.replace(/\/+$/,"")}/liked/${crypto.randomUUID()}`,r={type:"like",author:c,object:i,published:new Date().toISOString(),id:s},m=`/api/authors/${a}/inbox/`;try{let p=await fetch(m,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":d},body:JSON.stringify(r)});if(!p.ok){let T=await p.json();return alert(T.detail||"Failed to like")}let g=this.querySelector(".like-count"),I=parseInt(g.textContent)||0;g.textContent=`${I+1} ${I+1===1?"Like":"Likes"}`,this.disabled=!0}catch(p){console.error("Inbox like error",p),alert("Network error, could not like")}})}),document.querySelectorAll(".comment-btn").forEach(e=>{e.addEventListener("click",function(){let o=this.dataset.postId,i=encodeURIComponent(o),n=this.getAttribute("data-author-id"),a=n.split("/").filter(Boolean).pop();i&&n&&(window.location.href=`/authors/${a}/entries/${i}/`)})});let t=document.getElementById("update-btn");t&&t.addEventListener("click",async()=>{let e=document.body.dataset.profileId,o=document.querySelector('meta[name="csrf-token"]').content,i=`/api/authors/${e}/github_update/`;try{let n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o}}),a=await n.json();if(!n.ok)return alert(a.detail);alert(a.detail),n.status===201&&window.location.reload()}catch(n){console.error(n),alert("Unexpected error. Please try again later.")}finally{window.location.reload()}})});document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("description-text"),e=document.getElementById("edit-description-input"),o=document.getElementById("edit-description-btn"),i=document.getElementById("save-description-btn"),n=document.getElementById("cancel-description-btn"),a=document.getElementById("edit-description-buttons"),u=document.querySelector('meta[name="csrf-token"]').getAttribute("content");o&&e&&t&&i&&n&&(o.addEventListener("click",()=>{e.style.display="block",a.style.display="block",t.style.display="none",o.style.display="none",e.value=t.textContent.trim()}),n.addEventListener("click",()=>{e.style.display="none",a.style.display="none",t.style.display="block",o.style.display="inline"}),i.addEventListener("click",async()=>{let l=e.value.trim();if(!l){alert("Description can't be empty.");return}try{if(res=await fetch(y,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u},body:JSON.stringify({description:l})}),res.ok)t.textContent=l,t.style.display="block",o.style.display="inline",e.style.display="none",a.style.display="none";else{let d=await res.json();alert(d.error||"Update failed")}}catch(d){console.error("Description update error:",d),alert("Network error")}}))});async function U(){let t=document.getElementById("relationships-modal"),e=document.getElementById("relationships-content"),o=document.body.dataset.profileId,n=e.querySelector(".tabs button.active")?.dataset.tab;try{let u=await(await fetch(`/profile/${o}/relationships/?embed=true`)).text();e.innerHTML=u,t.style.display="flex";let l=document.querySelector("script[data-rel='true']");l&&l.remove();let d=document.createElement("script");d.src=window.STATIC_URL+"relationships.min.js",d.type="module",d.dataset.rel="true",d.onload=()=>{if(n){let c=e.querySelector(`.tabs button[data-tab="${n}"]`);c&&window.showTab&&window.showTab(n,c)}},document.body.appendChild(d)}catch{e.innerHTML="<p>Failed to load follow manager.</p>",t.style.display="flex"}}window.reloadRelationshipsModal=U;document.getElementById("open-relationships-modal")?.addEventListener("click",async t=>{t.preventDefault(),await U()});document.getElementById("close-relationships-modal")?.addEventListener("click",()=>{document.getElementById("relationships-modal").style.display="none"});})();
//# sourceMappingURL=profile.min.js.map
