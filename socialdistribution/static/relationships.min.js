(()=>{document.addEventListener("DOMContentLoaded",()=>{let n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),s=document.body.dataset.currentUserId;async function a(e){let o=e.replace(/\/$/,"").split("/").pop(),t=await fetch(`/api/authors/${o}/`);if(!t.ok)throw new Error("author fetch failed");return await t.json()}async function h(e,o,t){let T=`/api/authors/${t.split("/").filter(Boolean).pop()}/inbox/`,c;try{let i=await a(o),w=await a(t);c={type:"follow",summary:`${i.displayName} wants to follow ${w.displayName}`,actor:i,object:w}}catch{alert("Failed to fetch author info.");return}let f=await fetch(T,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify(c)});if(f.ok)e.textContent="Pending",e.disabled=!0,e.classList.remove("follow");else{let i=await f.json();alert(i.detail||"Failed to send follow request.")}}window.sendFollowRequest=h;async function p(e){let o=e.getAttribute("data-from-id"),t=e.getAttribute("data-to-id");(await fetch("/api/follow/",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({from_author:o,to_author:t})})).ok?window.reloadRelationshipsModal():alert("Failed to unfollow user.")}window.handleUnfollow=p;async function u(e){let o=e.getAttribute("data-from-id");(await fetch("/api/follow/",{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({from_author:o,to_author:s})})).ok?window.reloadRelationshipsModal():alert("Failed to accept request.")}window.handleAccept=u;async function y(e){let o=e.getAttribute("data-from-id");(await fetch("/api/follow/",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({from_author:o,to_author:s})})).ok?window.reloadRelationshipsModal():alert("Failed to decline request.")}window.handleDecline=y;async function r(e,o,t=!0){(await fetch("/api/follow/",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({from_author:e,to_author:o})})).ok?t&&window.reloadRelationshipsModal():alert("Unfollow failed.")}window.unfollowThem=r;async function d(e,o,t=!0){(await fetch("/api/follow/",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({from_author:e,to_author:o})})).ok?t&&window.reloadRelationshipsModal():alert("Request failed.")}window.makeThemUnfollowMe=d;async function m(e,o){await Promise.all([r(e,o,!1),d(o,e,!1)]),window.reloadRelationshipsModal()}window.unfriend=m});function b(n,s){document.querySelectorAll(".tab-content").forEach(a=>a.style.display="none"),document.getElementById(n).style.display="block",document.querySelectorAll(".tabs button").forEach(a=>a.classList.remove("active")),s.classList.add("active")}window.showTab=b;})();
//# sourceMappingURL=relationships.min.js.map
