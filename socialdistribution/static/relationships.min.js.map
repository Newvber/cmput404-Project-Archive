{
  "version": 3,
  "sources": ["../../webapp/relationships.js"],
  "sourcesContent": ["// The following written with completion assistance from Microsoft, Copilot/ ChatGPT, OpenAI 2025-07-09\ndocument.addEventListener('DOMContentLoaded', () => {\n  const csrftoken = document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content');\n  const currentUserId = document.body.dataset.currentUserId;\n\n  async function fetchAuthorData(id) {\n    const Uuid = id.replace(/\\/$/, '').split('/').pop();\n    const res = await fetch(`/api/authors/${Uuid}/`);\n    if (!res.ok) throw new Error('author fetch failed');\n    return await res.json();\n  }\n\n  async function sendFollowRequest(button, fromId, toId) {\n    const toUuid = toId.split('/').filter(Boolean).pop();\n    let inboxUrl = `/api/authors/${toUuid}/inbox/`;\n    let payload;\n    try {\n        const actor = await fetchAuthorData(fromId);\n        const object = await fetchAuthorData(toId);     \n\n      // Always send through our backend so it can handle remote auth\n      payload = {\n        type: 'follow',\n        summary: `${actor.displayName} wants to follow ${object.displayName}`,\n        actor,\n        object\n      };\n    } catch (err) {\n      alert('Failed to fetch author info.');\n      return;\n    }\n    const response = await fetch(inboxUrl, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': csrftoken\n      },\n      body: JSON.stringify(payload)\n    });\n    if (response.ok) {\n      button.textContent = 'Pending';\n      button.disabled = true;\n      button.classList.remove('follow');\n    } else {\n      const err = await response.json();\n      alert(err.detail || 'Failed to send follow request.');\n    }\n  }\n  window.sendFollowRequest = sendFollowRequest;\n\n  async function handleUnfollow(button) {\n    const fromId = button.getAttribute('data-from-id');\n    const toId   = button.getAttribute('data-to-id');\n    const response = await fetch('/api/follow/', {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },\n      body: JSON.stringify({ from_author: fromId, to_author: toId })\n    });\n    if (response.ok) window.reloadRelationshipsModal();\n    else alert('Failed to unfollow user.');\n  }\n  window.handleUnfollow = handleUnfollow;\n\n  async function handleAccept(button) {\n    const fromId = button.getAttribute('data-from-id');\n    const response = await fetch('/api/follow/', {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },\n      body: JSON.stringify({ from_author: fromId, to_author: currentUserId })\n    });\n    if (response.ok) window.reloadRelationshipsModal();\n    else alert('Failed to accept request.');\n  }\n  window.handleAccept = handleAccept;\n\n  async function handleDecline(button) {\n    const fromId = button.getAttribute('data-from-id');\n    const response = await fetch('/api/follow/', {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },\n      body: JSON.stringify({ from_author: fromId, to_author: currentUserId })\n    });\n    if (response.ok) window.reloadRelationshipsModal();\n    else alert('Failed to decline request.');\n  }\n  window.handleDecline = handleDecline;\n\n  async function unfollowThem(fromId, toId, reload = true) {\n    const response = await fetch('/api/follow/', {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': csrftoken\n      },\n      body: JSON.stringify({ from_author: fromId, to_author: toId })\n    });\n    if (response.ok) {\n      if (reload) window.reloadRelationshipsModal();\n    } else {\n      alert('Unfollow failed.');\n    }\n  }\n  window.unfollowThem = unfollowThem;\n  \n  async function makeThemUnfollowMe(fromId, toId, reload = true) {\n    const response = await fetch('/api/follow/', {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': csrftoken\n      },\n      body: JSON.stringify({ from_author: fromId, to_author: toId })\n    });\n    if (response.ok) {\n      if (reload) window.reloadRelationshipsModal();\n    } else {\n      alert('Request failed.');\n    }\n  }\n  window.makeThemUnfollowMe = makeThemUnfollowMe;\n\n  async function unfriend(user1, user2) {\n    await Promise.all([\n      unfollowThem(user1, user2, false),\n      makeThemUnfollowMe(user2, user1, false)\n    ]);\n    window.reloadRelationshipsModal();\n  }\n  window.unfriend = unfriend;\n\n});\n\nfunction showTab(tabId, button) {\n  document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');\n  document.getElementById(tabId).style.display = 'block';\n  document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));\n  button.classList.add('active');\n}\nwindow.showTab = showTab;"],
  "mappings": "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",
  "names": ["csrftoken", "currentUserId", "fetchAuthorData", "id", "Uuid", "res", "sendFollowRequest", "button", "fromId", "toId", "inboxUrl", "payload", "actor", "object", "response", "err", "handleUnfollow", "handleAccept", "handleDecline", "unfollowThem", "reload", "makeThemUnfollowMe", "unfriend", "user1", "user2", "showTab", "tabId", "el", "btn"]
}
