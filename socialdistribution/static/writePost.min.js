(()=>{document.addEventListener("DOMContentLoaded",()=>{function b(){return document.querySelector('meta[name="csrf-token"]').getAttribute("content")}let o=document.querySelector("#content"),n=document.getElementById("preview"),f=document.querySelector(".editor-container"),m=f.firstElementChild,v=f.lastElementChild,s=document.querySelector("#contentType"),T=document.querySelector("#image"),c=document.getElementById("uploadImageBtn"),d=document.getElementById("insertImageBtn"),i="",t="";function w(){let e=s.value;e==="image"?(m.style.display="none",v.style.display="",o.value="",n.innerHTML="",c.style.display="",d.style.display="none",i="",t=""):e==="text/markdown"?(m.style.display="",v.style.display="",n.innerHTML=convertMarkdownToHtml(o.value),c.style.display="none",d.style.display="",i="",t=""):(m.style.display="",v.style.display="none",n.innerHTML="",c.style.display="none",d.style.display="none",i="",t="")}s.addEventListener("change",w);function S(e){return new Promise((a,r)=>{let l=new FileReader;l.onload=()=>{let p=l.result.split(",")[1];a(p)},l.onerror=r,l.readAsDataURL(e)})}o.addEventListener("input",()=>{s.value==="text/plain"?n.innerHTML="":n.innerHTML=convertMarkdownToHtml(o.value)}),n.innerHTML=convertMarkdownToHtml(o.value),w();let u=document.querySelector(".post-btn");u.addEventListener("click",async e=>{if(e.preventDefault(),u.disabled)return;u.disabled=!0;let a=document.querySelector("#title").value.trim(),r=document.querySelector("#description").value.trim(),l=document.querySelector('input[name="visibility"]:checked').value.toUpperCase(),p=document.querySelector("#contentType").value,h=document.querySelector("#content").value.trim(),g=p;if(p==="image"){if(!i){alert("Please choose an image.");return}h=i,t==="application/base64"?g="application/base64":g=`${t};base64`}let k=window.location.pathname.split("/")[2],E=`/api/authors/${decodeURIComponent(k).split("/").pop()}/entries/`,M={title:a,content:h,description:r,visibility:l,contentType:g};try{let y=await fetch(E,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":b()},body:JSON.stringify(M)}),L=await y.json();if(!y.ok){console.error("Server error:",L);return}console.log("Success:",L),alert("Post created successfully!"),window.location.href="/"}catch(y){console.error("Fetch error:",y)}finally{u.disabled=!1}}),document.querySelector(".cancel-btn").addEventListener("click",()=>{window.history.back()}),c.addEventListener("click",()=>{T.click()}),T.addEventListener("change",async function(){if(s.value!=="image")return;let e=this.files[0];if(!e)return;let a=await S(e);i=a,e.type==="image/png"?t="image/png":e.type==="image/jpeg"?t="image/jpeg":t="application/base64",t==="application/base64"?n.innerHTML=`<img src="data:${t};base64,${a}" style="max-width:100%;">`:n.innerHTML=`<img src="data:${e.type};base64,${a}" style="max-width:100%;">`,this.value=""}),d.addEventListener("click",()=>{let e=prompt("Enter image URL:");if(!e)return;let r=`![${prompt("Enter alt text (optional):","")||""}](${e})`;o.value+=(o.value?`

`:"")+r,n.innerHTML=convertMarkdownToHtml(o.value)})});})();
//# sourceMappingURL=writePost.min.js.map
