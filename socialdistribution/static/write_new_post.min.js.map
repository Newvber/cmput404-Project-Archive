{
  "version": 3,
  "sources": ["../../webapp/write_new_post.js"],
  "sourcesContent": ["// write_new_post.js\n\nfunction getCSRFToken() {\n    return document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content');\n}\n\nconst imageMap = {};\nlet imageCounter = 1;\nconst textarea = document.querySelector('#content');\nconst previewEl = document.getElementById('preview');\nconst editorContainer = document.querySelector('.editor-container');\nconst editBox = editorContainer.firstElementChild;\nconst previewBox = editorContainer.lastElementChild;\nconst contentTypeSelect = document.querySelector('#contentType');\nconst imageInput = document.querySelector('#image');\nlet soloImageBase64 = '';\nlet soloImageMime = '';\n\nfunction updateMode() {\n    const type = contentTypeSelect.value;\n    if (type === 'image') {\n        editBox.style.display = 'none';\n        previewBox.style.display = '';\n        textarea.value = '';\n        previewEl.innerHTML = '';\n        imageInput.removeAttribute('multiple');\n    } else {\n        editBox.style.display = '';\n        previewBox.style.display = '';\n        previewEl.innerHTML = convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n        imageInput.setAttribute('multiple', '');\n        soloImageBase64 = '';\n        soloImageMime = '';\n    }\n}\n\ncontentTypeSelect.addEventListener('change', updateMode);\n\nfunction readFileAsBase64(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n            const base64 = reader.result.split(',')[1];\n            resolve(base64);\n        };\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n    });\n}\n\nfunction expandImagePlaceholders(text) {\n    let result = text;\n    for (const key in imageMap) {\n        result = result.replaceAll(`(${key})`, `(${imageMap[key]})`);\n    }\n    return result;\n}\n\ntextarea.addEventListener('input', () => {\n    previewEl.innerHTML = convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n});\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    previewEl.innerHTML = convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n    updateMode();\n});\n\ndocument.querySelector('.post-btn').addEventListener('click', async (event)=> {\n    event.preventDefault();\n\n    const title = document.querySelector('#title').value.trim();\n    const visibility = document.querySelector('input[name=\"visibility\"]:checked').value.toUpperCase();\n    const selectedContentType = document.querySelector('#contentType').value;\n\n    let content = expandImagePlaceholders(document.querySelector('#content').value.trim());\n    let finalContentType = selectedContentType;\n\n    if (selectedContentType === 'image') {\n        if (!soloImageBase64) {\n            alert('Please choose an image.');\n            return;\n        }\n        content = soloImageBase64;\n        if (soloImageMime === 'application/base64') {\n            finalContentType = 'application/base64';\n        } else {\n            finalContentType = `${soloImageMime};base64`;\n        }\n    }\n\n    const authorId = window.location.pathname.split('/')[2];\n    const url = `/api/authors/${authorId}/entries/`;\n\n    const data = {\n        title,\n        content,\n        description: title,\n        visibility,\n        contentType: finalContentType,\n    };\n\n    try {\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'X-CSRFToken': getCSRFToken()\n            },\n            body: JSON.stringify(data)\n        });\n\n        const result = await response.json();\n\n        if (!response.ok) {\n            console.error(\"Server error:\", result);\n            return;\n        }\n\n        console.log(\"Success:\", result);\n        alert(\"Post created successfully!\");\n        window.location.href = `/`;\n    } catch (err) {\n        console.error(\"Fetch error:\", err);\n    }\n});\n\ndocument.querySelector('.cancel-btn').addEventListener('click', () => {\n    window.history.back();\n});\n\ndocument.querySelector('#image').addEventListener('change', async function () {\n    const files = Array.from(this.files).slice(0, 15);\n    if (files.length > 0) {\n        if (contentTypeSelect.value === 'image') {\n            const file = files[0];\n            const base64 = await readFileAsBase64(file);\n            soloImageBase64 = base64;\n            if (file.type === 'image/png') {\n                soloImageMime = 'image/png';\n            } else if (file.type === 'image/jpeg') {\n                soloImageMime = 'image/jpeg';\n            } else {\n                soloImageMime = 'application/base64';\n            }\n            if (soloImageMime === 'application/base64') {\n                previewEl.innerHTML = `<img src=\"data:${soloImageMime};base64,${base64}\" style=\"max-width:100%;\">`;\n            } else {\n                previewEl.innerHTML = `<img src=\"data:${file.type};base64,${base64}\" style=\"max-width:100%;\">`;\n            }\n            this.value = '';\n        } else {\n            for (const file of files) {\n                const base64 = await readFileAsBase64(file);\n                const placeholder = `image${imageCounter++}`;\n                imageMap[placeholder] = `data:${file.type};base64,${base64}`;\n                const markdown = `![${file.name}](${placeholder})`;\n                textarea.value += (textarea.value ? \"\\n\\n\" : \"\") + markdown;\n            }\n            document.getElementById('preview').innerHTML =\n                convertMarkdownToHtml(expandImagePlaceholders(textarea.value));\n            document.querySelector('#contentType').value = 'text/markdown';\n            this.value = '';\n        }\n    }\n});\n"],
  "mappings": "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",
  "names": ["getCSRFToken", "imageMap", "imageCounter", "textarea", "previewEl", "editorContainer", "editBox", "previewBox", "contentTypeSelect", "imageInput", "soloImageBase64", "soloImageMime", "updateMode", "expandImagePlaceholders", "readFileAsBase64", "file", "resolve", "reject", "reader", "base64", "text", "result", "key", "event", "title", "visibility", "selectedContentType", "content", "finalContentType", "url", "data", "response", "err", "files", "placeholder", "markdown"]
}
